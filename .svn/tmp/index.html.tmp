<html>
<head>
</head>
<body onload="initialize()">
    <table width="100%">
        <tr width="100%">
            <td width="85%" height="700px">
                <div id="map_canvas" style="width: 100%; height: 100%">
                </div>
            </td>
            </div>
            <td width="15%">
                i made a change and commited it to git.
            </td>
        </tr>
    </table>
</body>
<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key=AIzaSyC6F72CN5MnSvg_LxxlOURuwcJVzfH6kVs&sensor=false">
    </script>
<script type="text/javascript">
    var map;
    function initialize() {
        var myOptions = {
            zoom: 16,
            center: new google.maps.LatLng(29.717821, -95.402561),
            mapTypeId: google.maps.MapTypeId.ROADMAP
        }
        map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
        google.maps.event.addListener(map, 'click', function (event) {
            placeMarker(event.latLng);
        });
		downloadEvents(new google.maps.LatLng(29.717821, -95.402561));
		var currentDate = new XDate();
		}

	//var otherEventInfoWindow;
	var eventsList;
	function getEventByName(name){
		var i;
		for(i;i<eventsList.length;i++){
			if(eventsList[i].name == name){
				return eventsList[i];
			}
		}
		return -1;
	}
	
	function createMarker(pos, t,html) {
    var marker = new google.maps.Marker({       
        position: pos, 
        map: map,  // google.maps.Map 
        title: t,
		html: ''
    }); 
    google.maps.event.addListener(marker, 'click', function() { 
		
		otherEventsInfoWindow.setContent(this.title);
		otherEventsInfoWindow.open(map, this);
    }); 
    return marker;  
}
	/* now inside your initialise function */
otherEventsInfoWindow = new google.maps.InfoWindow({
content: "holding..."
});
	function downloadEvents(location){
		var eventXhr = new XMLHttpRequest();
		eventXhr.onreadystatechange=function()
		{
			if (eventXhr.readyState==4 && eventXhr.status==200){
				//alert(eventXhr.responseText);
				eventsList = JSON.parse(eventXhr.responseText);
				var i = 0;
				for(i;i<eventsList.length;i++){
					var curEvent = eventsList[i];
					var eventMarker = createMarker(new google.maps.LatLng(curEvent.latitude, curEvent.longitude),curEvent.name,curEvent.html);
						
					
				}
			}
		}
		eventXhr.open("GET","/getEvents",true);
		eventXhr.send();
	}
	
    /*Marker code weee*/
    var marker;
    function placeMarker(location) {
        var titleString = "Lat: " + location.lat() + ", Lng: " + location.lng();
        if (marker) {
            marker.setPosition(location);
            marker.setAnimation(google.maps.Animation.DROP);
            marker.setTitle(titleString);
        } else {

            /*Make new markers here*/
            marker = new google.maps.Marker({
                position: location,
                map: map,
                animation: google.maps.Animation.DROP,
                draggable: true,
                title: titleString
            });
            google.maps.event.addListener(marker, 'click', function (event) {
                toggleBounce();
				infowindow.open(map,marker);
				document.getElementsByName("markerLat")[0].value = event.latLng.lat();
				document.getElementsByName("markerLng")[0].value = event.latLng.lng();
            });
            google.maps.event.addListener(marker, 'dragend', function (event) {
                markerDragEnd(marker, event);
            });
			
        }
    }
	/*
	var markerPopupHTML = '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">'+
'<html xmlns="http://www.w3.org/1999/xhtml" >'+
'<head>'+
    '<title>Marker HTML</title>'+
    '<form>'+
 '<p><label>Event name: <input name=event_name></label></p>'+
 '<fieldset>'+
'  <legend>Privacy</legend>'+
  '<p><label> <input type=radio name=size> Private </label></p>'+
  '<p><label> <input type=radio name=size> Public </label></p>'+
 '</fieldset>'+
 '<fieldset>'+
'  <legend> Event Tags </legend>'+
  '<p><label> <input name=tags type=checkbox> Food </label></p>'+
  '<p><label> <input name=tags type=checkbox> Drinking </label></p>'+
  '<p><label> <input name=tags type=checkbox> Lecture </label></p>'+
  '<p><label> <input name=tags type=checkbox> Free </label></p>'+
 '</fieldset>'+
 '<input type="date" />'+
 '<input type="time" />'+
'</form>'+
'</head>'+
'<body>'+
''+
'</body>'+
'</html>'+
'';
*/
var markerPopupHTML;
var infowindow;
var markerXhr = new XMLHttpRequest();
markerXhr.onreadystatechange=function()
  {
  if (markerXhr.readyState==4 && markerXhr.status==200)
    {
    markerPopupHTML=markerXhr.responseText;
	infowindow = new google.maps.InfoWindow({
		content: markerPopupHTML
	});
    }
  }
markerXhr.open("POST","/getMarkerPopup",true);
markerXhr.send();
    function markerDragEnd(marker, event) {
        var titleString = "Lat: " + event.latLng.lat() + ", Lng: " + event.latLng.lng();
        marker.setTitle(titleString);
    }

	function updateLatLng(){
		document.getElementsByName("markerLat")[0].value = marker.getPosition().lat();
		document.getElementsByName("markerLng")[0].value = marker.getPosition().lng();
	}
    function toggleBounce() {
        if (marker.getAnimation() != null) {
            marker.setAnimation(null);
        } else {
            marker.setAnimation(google.maps.Animation.BOUNCE);
        }
    }
	
    </script>
	<script type="text/javascript">
    var datefield=document.createElement("input")
    datefield.setAttribute("type", "date")
    if (datefield.type!="date"){ //if browser doesn't support input type="date", load files for jQuery UI Date Picker
        document.write('<link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="stylesheet" type="text/css" />\n')
        document.write('<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js"><\/script>\n')
        document.write('<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"><\/script>\n')
    }
</script>
<script type="text/javascript" src="https://github.com/arshaw/xdate/blob/master/src/xdate.js"></script>
</html>
